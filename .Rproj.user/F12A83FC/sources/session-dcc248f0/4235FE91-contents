---
title: "CSI:Dixie Greenville"
author: "Candy Boatwright"
format: html
---



```{r}
#load libraries
library(tidytext)
library(tidyverse)
library(readtext)
library(tm)
library(ggplot2) 
library(ggmap)
library(tidygeocoder)
```


```{r}
#load CSI:Dixie Greenville County data
CSI.GVL <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQzO3uN1w0-A_rN3bHuBWDr1iQe9hPZ68u7igu-I8wWDEpHSWH5T3AQFPvaa-VMSbuB8Z8X5wxSjmA6/pub?output=csv") 

print(CSI.GVL)

```

```{r}
#tidy data
CSI.GVL.TIDY <- CSI.GVL %>%
  separate(NAME, c("FIRST.NAME", "LAST.NAME"), sep = " ", remove = FALSE) %>% #separates first and last names
  separate(DATE, c("MONTH", "DAY", "YEAR"), sep = " ", remove = FALSE) #separates dates into month, day, year

head(CSI.GVL.TIDY)
```

```{r}
#plot deaths by year
ggplot(CSI.GVL.TIDY, aes(x = YEAR)) + theme(axis.text.x=element_text(angle=90,hjust=1)) + geom_dotplot(binwidth = 1)

```

```{r}
death.type <- CSI.GVL.TIDY %>%
  group_by(DEATH.TYPE) %>%
  summarize(count = n())
  
ggplot(death.type, aes(x = DEATH.TYPE, y = count)) +  geom_col() 
```


```{r}
#chart by DEATH.TYPE
year.count <- CSI.GVL.TIDY %>%
  group_by(YEAR) %>%
  summarize(count = n())
  
ggplot(year.count, aes(x = YEAR, y = count)) +  geom_point(aes(size = count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) 
```

```{r}
#write code to display type of death by decade
by.year <- CSI.GVL.TIDY %>%
  group_by(YEAR, DEATH.TYPE) %>%
  summarize(count = n())

ggplot(by.year, aes(x = DEATH.TYPE, y = count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) + geom_col() + facet_wrap(~YEAR)
```

```{r}
#group by decade - create a new dataframe by decade and average death types over years within that decade"

by.decade <- CSI.GVL.TIDY %>%
  mutate(DECADE = if_else(YEAR >= 1800 & YEAR < 1810, "Aughts",
                          if_else(YEAR >= 1810 & YEAR < 1820, "Tens",
                          if_else(YEAR >= 1820 & YEAR < 1830, "Twenties",
                          if_else(YEAR >= 1830 & YEAR < 1840, "Thirties",
                          if_else(YEAR >= 1840 & YEAR < 1850, "Forties",
                          if_else(YEAR >= 1850 & YEAR < 1860, "Fifties",
                          if_else(YEAR >= 1860 & YEAR < 1870, "Sixties",
                          if_else(YEAR >= 1870 & YEAR < 1880, "Seventies",
                          if_else(YEAR >= 1880 & YEAR < 1890, "Eighties",
                          if_else(YEAR >= 1890 & YEAR < 1900, "Nineties",                                   "Other"))))))))))) %>% as_tibble()

print(by.decade)
```

```{r}
#chart DEATH.TYPE by DECADE

decade.count <- by.decade %>%
  group_by(DECADE, DEATH.TYPE) %>%
  summarize(count = n())

ggplot(decade.count, aes(DEATH.TYPE, count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) + geom_col() + facet_wrap(~DECADE)
```

```{r}
by.year <- CSI.GVL.TIDY %>%
  group_by(YEAR, DEATH.TYPE) %>%
  summarize(count = n()) %>%

ggplot(aes(x = DEATH.TYPE, y = count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) + geom_col() + facet_wrap(~YEAR)
```

```{r}
#chart total number of deaths by decade
total.by.decade <- by.decade %>%
  group_by(NAME, DECADE) %>%
  summarize(count = n())
  
ggplot(total.by.decade, aes(x = DECADE, y = count)) +  geom_col() 
```

In Greenville County, coroner inquests increase dramatically in from 1850 through the end of the 1880s, with the 1870s and 80s having the highest occurrences by a significant margin.

Some of the type of death increases would correspond with the Civil War. For example, the homicide and suicide rates during the 1850s and 60s are the highest compared to all other decades. What is interesting, however, is that the types of death that would seem as if there would not be a tremendous fluctuation due to war (ie: accidents and natural causes) also see a large spike during these decades. 

Stephen Berry in his book, Count the Dead, addresses the rise of the modern state and its correlation with the quantification of death. During the legislative session of 1849 a tremendous reform was passed through the United States Congress, almost by accident. As the last bill before the session adjorned for the year it received almost no review and was passed as speedily as possible. When Congress reconviened in 1850 there was an immediate reaction to the actual contents of the bill followed by resistance. South Carolina Senator .. 

In examining the coroners inquest from Greenville County it is clear that this practice of refusing to name or further identify black individuals trickled down from the highest governmental offices to the local levels. It is also clear that infants and children of undetermined race often were not named in the inquests.

```{r}
age.sorted <- CSI.GVL.TIDY %>%
  mutate(AGE = if_else(str_detect(DECEASED.DESCRIPTION, "child"), "child",
                       if_else(str_detect(DECEASED.DESCRIPTION, "infant"), "child",
                        if_else(str_detect(DECEASED.DESCRIPTION, "boy"), "child", if_else(str_detect(DECEASED.DESCRIPTION, "son"), "child", "adult")))))

head(age.sorted)
```

```{r}
#adds sorting by race to dataframe previously sorted by age
all.sorted <- age.sorted %>%
  mutate(RACE = if_else(str_detect(DECEASED.DESCRIPTION, "black"), "black",
                  if_else(str_detect(DECEASED.DESCRIPTION, "negro"), "black",
                  if_else(str_detect(DECEASED.DESCRIPTION, "negroe"), "black",                          if_else(str_detect(DECEASED.DESCRIPTION, "colored"), "black",
                  if_else(str_detect(DECEASED.DESCRIPTION, "free"), "black",
                  if_else(str_detect(DECEASED.DESCRIPTION, "slave"), "black",                             "white")))))))

head(all.sorted)
```

```{r}

# library

 
# Build Dataset
#group <- c(rep("group-1",4),rep("group-2",2),rep("group-3",3))
#subgroup <- paste("subgroup" , c(1,2,3,4,1,2,1,2,3), sep="-")
#value <- c(13,5,22,12,11,7,3,1,23)
#data <- data.frame(group,subgroup,value)
 
# treemap

#library(waffle)

count.sorted <- all.sorted %>%
  group_by(AGE, RACE) %>%
  summarize(count = n()) 


ggplot(count.sorted, aes(x=, y=count)) + geom_point()
  

#waffle(count.sorted, row = 10, legend_pos = "bottom")

#treemap(all.sorted,
 #           index=c("AGE","RACE"),
  #          vSize= count,
   #         type="index"
    #        ) 
```



```{r}
var <- mpg$class  # the categorical data 

## Prep data (nothing to change here)
nrows <- 10
df <- expand.grid(y = 1:nrows, x = 1:nrows)
categ_table <- round(table(var) * ((nrows*nrows)/(length(var))))
categ_table
#>   2seater    compact    midsize    minivan     pickup subcompact        suv 
#>         2         20         18          5         14         15         26 

df$category <- factor(rep(names(categ_table), categ_table))  
# NOTE: if sum(categ_table) is not 100 (i.e. nrows^2), it will need adjustment to make the sum to 100.

## Plot
ggplot(df, aes(x = x, y = y, fill = category)) + 
        geom_tile(color = "black", size = 0.5) +
        scale_x_continuous(expand = c(0, 0)) +
        scale_y_continuous(expand = c(0, 0), trans = 'reverse') +
        scale_fill_brewer(palette = "Set3") +
        labs(title="Waffle Chart", subtitle="'Class' of vehicles",
             caption="Source: mpg") + 
        theme(panel.border = element_rect(size = 2),
              plot.title = element_text(size = rel(1.2)),
              axis.text = element_blank(),
              axis.title = element_blank(),
              axis.ticks = element_blank(),
              legend.title = element_blank(),
              legend.position = "right")
```


#Explore if Greenville is different than other areas of the state. Show a difference in development of local government (ie: coroners' office)? Show a difference in demographics? Show a difference in amount/types of local industry?

Anderson County Dataset and Charts

```{r}
#load Anderson County data
CSI.ANDERSON <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vSZ5lXF7WTLe71GUg6Z_h6HgtoeQJ6BX1JQ7H6IgkGvrXSqzxIh720ElLPeWmzoXytW2O9J7bgL82Kg/pub?output=csv") 

print(CSI.ANDERSON)
```

```{r}
CSI.ANDERSON.TIDY <- CSI.ANDERSON %>%
  separate(NAME, c("FIRST.NAME", "LAST.NAME"), sep = " ", remove = FALSE) %>% #separates first and last names
  separate(DATE, c("MONTH", "DAY", "YEAR"), sep = " ", remove = FALSE) #separates dates into month, day, year

head(CSI.ANDERSON.TIDY)
```

```{r}
#group by decade - create a new dataframe by decade and average death types over years within that decade"

by.decade.anderson <- CSI.ANDERSON.TIDY %>%
  mutate(DECADE = if_else(YEAR >= 1800 & YEAR < 1810, "Aughts",
                          if_else(YEAR >= 1810 & YEAR < 1820, "Tens",
                          if_else(YEAR >= 1820 & YEAR < 1830, "Twenties",
                          if_else(YEAR >= 1830 & YEAR < 1840, "Thirties",
                          if_else(YEAR >= 1840 & YEAR < 1850, "Forties",
                          if_else(YEAR >= 1850 & YEAR < 1860, "Fifties",
                          if_else(YEAR >= 1860 & YEAR < 1870, "Sixties",
                          if_else(YEAR >= 1870 & YEAR < 1880, "Seventies",
                          if_else(YEAR >= 1880 & YEAR < 1890, "Eighties",
                          if_else(YEAR >= 1890 & YEAR < 1900, "Nineties",                                   "Other"))))))))))) %>% as_tibble()

print(by.decade.anderson)
```

```{r}
#chart Anderson by DEATH.TYPE
death.type.anderson <- CSI.ANDERSON.TIDY %>%
  group_by(DEATH.TYPE) %>%
  summarize(count = n())
  
ggplot(death.type.anderson, aes(x = DEATH.TYPE, y = count)) +  geom_col() 
```


```{r}
#chart DEATH.TYPE by DECADE

decade.count.anderson <- by.decade.anderson %>%
  group_by(DECADE, DEATH.TYPE) %>%
  summarize(count = n())

ggplot(decade.count.anderson, aes(DEATH.TYPE, count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) + geom_col() + facet_wrap(~DECADE)
```

```{r}
#chart total number of Anderson deaths by decade
total.anderson.by.decade <- by.decade.anderson %>%
  group_by(NAME, DECADE) %>%
  summarize(count = n())
  
ggplot(total.anderson.by.decade, aes(x = DECADE, y = count)) +  geom_col() 
```

```{r}
#chart Anderson by year count
year.count.anderson <- CSI.ANDERSON.TIDY %>%
  group_by(YEAR) %>%
  summarize(count = n())
  
ggplot(year.count.anderson, aes(x = YEAR, y = count)) +  geom_point(aes(size = count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) 
```

Chesterfield County Dataset and Charts

```{r}
#load Chesterfield County data
CSI.CHESTERFIELD <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vSiyRbp_NP79e2pOWCwtrQRUFbZ0HrPkPI4XiR5qcREiRhq2ifqJGh0oKWSaB19GPgb2_Z5pzEOo6PN/pub?output=csv")

print(CSI.CHESTERFIELD)
```

```{r}
CSI.CHESTERFIELD.TIDY <- CSI.CHESTERFIELD %>%
  separate(NAME, c("FIRST.NAME", "LAST.NAME"), sep = " ", remove = FALSE) %>% #separates first and last names
  separate(DATE, c("MONTH", "DAY", "YEAR"), sep = " ", remove = FALSE) #separates dates into month, day, year

head(CSI.CHESTERFIELD.TIDY)
```

```{r}
#group by decade - create a new dataframe by decade and average death types over years within that decade"

by.decade.chesterfield <- CSI.CHESTERFIELD.TIDY %>%
  mutate(DECADE = if_else(YEAR >= 1800 & YEAR < 1810, "Aughts",
                          if_else(YEAR >= 1810 & YEAR < 1820, "Tens",
                          if_else(YEAR >= 1820 & YEAR < 1830, "Twenties",
                          if_else(YEAR >= 1830 & YEAR < 1840, "Thirties",
                          if_else(YEAR >= 1840 & YEAR < 1850, "Forties",
                          if_else(YEAR >= 1850 & YEAR < 1860, "Fifties",
                          if_else(YEAR >= 1860 & YEAR < 1870, "Sixties",
                          if_else(YEAR >= 1870 & YEAR < 1880, "Seventies",
                          if_else(YEAR >= 1880 & YEAR < 1890, "Eighties",
                          if_else(YEAR >= 1890 & YEAR < 1900, "Nineties",                                   "Other"))))))))))) %>% as_tibble()

print(by.decade.chesterfield)
```

```{r}
#chart Chesterfield by DEATH.TYPE
death.type.chesterfield <- CSI.CHESTERFIELD.TIDY %>%
  group_by(DEATH.TYPE) %>%
  summarize(count = n())
  
ggplot(death.type.chesterfield, aes(x = DEATH.TYPE, y = count)) +  geom_col() 
```


```{r}
#chart DEATH.TYPE by DECADE

decade.count.chesterfield <- by.decade.chesterfield %>%
  group_by(DECADE, DEATH.TYPE) %>%
  summarize(count = n())

ggplot(decade.count.chesterfield, aes(DEATH.TYPE, count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) + geom_col() + facet_wrap(~DECADE)
```

```{r}
#chart total number of Chesterfield deaths by decade
total.chesterfield.by.decade <- by.decade.chesterfield %>%
  group_by(NAME, DECADE) %>%
  summarize(count = n())
  
ggplot(total.chesterfield.by.decade, aes(x = DECADE, y = count)) +  geom_col() 
```

```{r}
#chart Chesterfield by year count
year.count.chesterfield <- CSI.CHESTERFIELD.TIDY %>%
  group_by(YEAR) %>%
  summarize(count = n())
  
ggplot(year.count.chesterfield, aes(x = YEAR, y = count)) +  geom_point(aes(size = count)) + theme(axis.text.x=element_text(angle=90,hjust=1, size=5)) 
```


Horry County Dataset and Charts

```{r}
#load Horry County data
CSI.HORRY <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQLbn85PImxeinLSgyS-CXgm3uPgp663HrzzVLeqYPa40QIaWWADQcbnhZBKR7MSHHzNFPk9PWdrBrh/pub?output=csv")

print(CSI.HORRY)
```

```{r}
CSI.HORRY.TIDY <- CSI.HORRY %>%
  separate(NAME, c("FIRST.NAME", "LAST.NAME"), sep = " ", remove = FALSE) %>% #separates first and last names
  separate(DATE, c("MONTH", "DAY", "YEAR"), sep = " ", remove = FALSE) #separates dates into month, day, year

head(CSI.HORRY.TIDY)
```

```{r}
#group by decade - create a new dataframe by decade and average death types over years within that decade"

by.decade.horry <- CSI.HORRY.TIDY %>%
  mutate(DECADE = if_else(YEAR >= 1800 & YEAR < 1810, "Aughts",
                          if_else(YEAR >= 1810 & YEAR < 1820, "Tens",
                          if_else(YEAR >= 1820 & YEAR < 1830, "Twenties",
                          if_else(YEAR >= 1830 & YEAR < 1840, "Thirties",
                          if_else(YEAR >= 1840 & YEAR < 1850, "Forties",
                          if_else(YEAR >= 1850 & YEAR < 1860, "Fifties",
                          if_else(YEAR >= 1860 & YEAR < 1870, "Sixties",
                          if_else(YEAR >= 1870 & YEAR < 1880, "Seventies",
                          if_else(YEAR >= 1880 & YEAR < 1890, "Eighties",
                          if_else(YEAR >= 1890 & YEAR < 1900, "Nineties",                                   "Other"))))))))))) %>% as_tibble()

print(by.decade.horry)
```

```{r}
#chart Horry by DEATH.TYPE
death.type.horry <- CSI.HORRY.TIDY %>%
  group_by(DEATH.TYPE) %>%
  summarize(count = n())
  
ggplot(death.type.horry, aes(x = DEATH.TYPE, y = count)) +  geom_col() 
```


```{r}
#chart DEATH.TYPE by DECADE

decade.count.horry <- by.decade.horry %>%
  group_by(DECADE, DEATH.TYPE) %>%
  summarize(count = n())

ggplot(decade.count.horry, aes(DEATH.TYPE, count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) + geom_col() + facet_wrap(~DECADE)
```

```{r}
#chart total number of Horry deaths by decade
total.horry.by.decade <- by.decade.horry %>%
  group_by(NAME, DECADE) %>%
  summarize(count = n())
  
ggplot(total.horry.by.decade, aes(x = DECADE, y = count)) +  geom_col() 
```

```{r}
#chart Horry by year count
year.count.horry <- CSI.HORRY.TIDY %>%
  group_by(YEAR) %>%
  summarize(count = n())
  
ggplot(year.count.horry, aes(x = YEAR, y = count)) +  geom_point(aes(size = count)) + theme(axis.text.x=element_text(angle=90,hjust=1)) 
```


```{r}
#create dataset for all CSI:Dixie South Carolina counties and # of inquests
CSI_DIXIE <- data_frame(COUNTY=c("Anderson", "Chesterfield", "Edgefield", "Fairfield", "Greenville", "Horry", "Kershaw", "Laurens", "Spartanburg", "Union"), STATE=("South Carolina"), NUMBER_OF_INQUESTS=c(152, 528, 515, 292, 141, 42, 262, 352, 326, 216))

#geocode counties
CSI.DIXIE.COORDINATES <- CSI_DIXIE %>% geocode(county = COUNTY, state = STATE, method='osm', lat = latitude, long = longitude)
head(CSI.DIXIE.COORDINATES)
```

```{r}
state <- map_data("state")
sc <- subset(state, region=="south carolina")
counties <- map_data("county")
sc_county <- subset(counties, region=="south carolina")

sc_map <- ggplot(data=sc, mapping=aes(x=long, y=lat, group=group)) + 
  coord_fixed(1.3) + 
  geom_polygon(color="black", fill="gray") + 
  geom_polygon(data=sc_county, fill=NA, color="white") + 
  geom_polygon(color="black", fill=NA) + 
  ggtitle('South Carolina Map with Counties') + 
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(),
        axis.title.y=element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank())
sc_map

#CSI.DIXIE.COORDINATES %>% ggplot() + 
 # geom_map(data = usa, map = usa, aes(longitude, latitude, map_id=region)) +
  #geom_point(data = CSI.DIXIE.COORDINATES, mapping = aes(x=longitude, y=latitude))
```

```{r}
sc.map.data <- left_join(state, CSI.DIXIE.COORDINATES, join_by(region == STATE))
```


```{r}
 
csi.map <- sc_map + geom_point(data = sc.map.data, mapping = aes(x=longitude, y=latitude))

csi.map
```

```{r}
state <- map_data("state")
sc <- subset(state, region=="south carolina")
counties <- map_data("county")
sc_county <- subset(counties, region=="south carolina")

sc_map <- ggplot(data=sc, mapping=aes(x=long, y=lat, group=group))

sc_map

ggplot() + 
  geom_map( data = usa, map = usa, aes(long, lat, map_id=region)) +
  geom_point(data = gayguides, mapping = aes(x=lon, y=lat))
```




